---
title:  "QueryDSL"

toc: true
toc_label: "go page"
toc_icon: "book"
toc_sticky : true

classes: wide

categories:
  - jpa
tags:
  - jpa
  - querydsl
last_modified_at: 2022-02-15T00:40:00-00:00
---

# What is Querydsl
Querydslì€ JPAë¥¼ í¸í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë„ì™€ì£¼ëŠ” Java í”„ë ˆì„ì›Œí¬ë¡œ SQL, JPQLì„ javaì½”ë“œë¡œ ì‘ì„± í•  ìˆ˜ ìˆë„ë¡ í•´ì£¼ëŠ” ì˜¤í”ˆì†ŒìŠ¤ì´ë‹¤.
ëŒ€ë¶€ë¶„ì˜ SQLì–¸ì–´ë¥¼ ë¬¸ìì—´ì´ ì•„ë‹Œ java typeìœ¼ë¡œ ì‘ì„±ì´ ê°€ëŠ¥í•˜ì—¬ IDEì™€ ì»´íŒŒì¼ ë„ì›€ì„ ë°›ê¸° ì‰½ê³  ë˜í•œ JDBCë„ ì¶”ìƒí™”í•˜ì—¬ native sql ì–¸ì–´ë¡œ ì§ì ‘ ë°ì´í„°ë² ì´ìŠ¤ì— ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤.   

# QueryDSL quick start
QueryDSL ì„¤ì •ì€ ì—¬ê¸°ì„œ í™•ì¸í•˜ì.
[https://kha0213.github.io/jpa/querydsl-quick-start/](https://kha0213.github.io/jpa/querydsl-quick-start/)      

# QueryDSL BASIC

## 1. Q-Type
ëª¨ë“  Q-Type í´ë˜ìŠ¤ëŠ” ê¸°ë³¸ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì œê³µí•œë‹¤.   
ê¸°ë³¸ì¸ìŠ¤í„´ìŠ¤ì˜ ì´ë¦„ìœ¼ë¡œ ì‹¤ì œ ì¿¼ë¦¬ì‹œ aliasê°€ ë‚˜ê°„ë‹¤.   
í˜¹ì‹œë¼ë„ aliasê°€ ê²¹ì¹˜ëŠ” ì¼ì´ ìˆìœ¼ë©´ ì•ˆë˜ê¸° ë•Œë¬¸ì— ì¼ë°˜ì ìœ¼ë¡œëŠ” ì´ë ‡ê²Œ ì‚¬ìš©í•œë‹¤.
```java
QMember m = QMember.member;
final Member findMember = queryFactory
    .selectFrom(m)
    .fetchOne();
```
ğŸ’»console
```jpaql
// jpql ì´ë‹¤.
select
    member1 
from
    Member member1 
where â€¢â€¢â€¢
    
```
new ì—°ì‚°ìë¥¼ ì‚¬ìš©í•˜ì—¬ Q-Typeì˜ ë³„ì¹­ì„ ì£¼ëŠ” ë°©ë²•ì´ë‹¤. ê°™ì€ í…Œì´ë¸” ì¡°ì¸í•  ë•Œ ì‚¬ìš©í•œë‹¤.
```java
QMember m = new QMember("m1");
    â€¢â€¢â€¢ Query ë¬¸ ì¶”ê°€
```
ğŸ’»console
```jpaql
// jpql ì´ë‹¤.
select
    m1 
from
    Member m1 
where â€¢â€¢â€¢
    
```

## QueryDSL Grammer
1. where
    * eq() : = ë¹„êµ
    * ne() : != ë¹„êµ
    * not() : ì•ì˜ ë‚´ìš© ë¶€ì •ë¬¸
    * isNotNull() : is not null
      
    * in() : in ë¬¸ë²•
    * notIn() : not in ë¬¸ë²•
    * between(a,b) : between a and b
      
    * goe() : í¬ê±°ë‚˜ ê°™ë‹¤. (>=) // gt or equal
    * gt() : í¬ë‹¤
    * loe() : ì‘ê±°ë‚˜ ê°™ë‹¤ (<=)
    * lt() : ì‘ë‹¤
        
    * like() : likeë¬¸ë²• (%ë„£ì–´ì¤˜ì•¼ í•œë‹¤.)
    * contains() : likeë¬¸ë²•ì¸ë° ì–‘ìª½ì— %ë„£ì€ íš¨ê³¼.
    * startsWith() : likeë¬¸ë²•ì¸ë° ë’¤ì— %ë„£ì€ íš¨ê³¼.
    
ê¸°ë³¸ì ì¸ sqlë¬¸ë²•ì€ ë‹¤ ìˆë‹¤. ê·¸ ì™¸ì—ë„ ë¬¸ë²• ë³´ê³  ì‹¶ìœ¼ë©´ â‡¾

ğŸ˜€example      
```java

member.username.eq("young") // username = 'young'
member.username.ne("young") // username != 'young'
member.username.eq("young").not() // username != 'young'

member.username.isNotNull() // username is not null

member.age.in(10,20) // age in (10,20)
member.age.notIn(10,20) // age not in (10,20)
member.age.between(10,20) // age between 10 and 20

member.age.goe(20) // age >= 20  -- gt or equal
member.age.gt(20) // age > 20
member.age.loe(20) // age <= 20
member.age.lt(20) // age < 20

member.username.like("%mem") // like '%mem'
member.username.contains("mem") // like '%mem%'
member.username.startsWith("mem") // like 'mem%'
```
where() ì•ˆì— ë“¤ì–´ê°€ëŠ” ì¡°ê±´ì€ , ë¡œ êµ¬ë¶„í•˜ì—¬ ì—¬ëŸ¬ ê°œì˜ and ì¡°ê±´ì„ í•  ìˆ˜ ìˆê³  .and()ë¡œ ì²´ì¸ë©”ì„œë“œë¡œ í•  ìˆ˜ ìˆë‹¤.   

```java
member.username.eq("mem").and(member.age.gt(10))) // í•˜ì§€ë§Œ ê´„í˜¸ê°€ ë§ì´ ìƒê²¨ì„œ ,ë¥¼ ì¶”ì²œí•œë‹¤.
member.username.eq("mem"), member.age.gt(10)) // ì´ê±¸ ì¶”ì²œí•œë‹¤.
member.username.eq("mem"), member.age.gt(10)), null // ì¤‘ê°„ì˜ nullì€ whereì ˆì— ê±¸ë¦¬ì§€ ì•ŠëŠ”ë‹¤.
member.username.eq("mem").or(member.age.gt(10))) // ë¬¼ë¡  orë„ ìˆë‹¤.
```

2. result
    * fetch() : ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ, ë°ì´í„° ì—†ìœ¼ë©´ ë¹ˆ ë¦¬ìŠ¤íŠ¸ ë°˜í™˜
    * fetchOne() : ë‹¨ ê±´ ì¡°íšŒ (ê²°ê³¼ ì—†ìœ¼ë©´ null, ë‘˜ ì´ìƒì´ë©´ ì—ëŸ¬)
    * fetchFirst() : ì¿¼ë¦¬ì— limit 1ì„ í•˜ê³  fetchOne()
    * fetchResults() : í˜ì´ì§• ì •ë³´ í¬í•¨, (total count ì¿¼ë¦¬ ì¶”ê°€ ì‹¤í–‰)
        - QueryResults ë¡œ ë¦¬í„´ëœë‹¤. ë‹¤ìŒì€ QueryResultsì˜ ë©”ì„œë“œì´ë‹¤.
        1. getTotal() : count ì¿¼ë¦¬ë¡œ ì´ ê°œìˆ˜ë¥¼ ê°€ì ¸ì˜¨ë‹¤.
        2. getLimit() : limitë¥¼ êµ¬í•œë‹¤.
        3. getOffset() : offsetì„ êµ¬í•œë‹¤. (ì‹œì‘ì´ 0)
        4. getResults() : fetch() ì²˜ëŸ¼ ë¦¬ìŠ¤íŠ¸ ë¦¬í„´í•œë‹¤.
    * fetchCount() : count ì¿¼ë¦¬ë¡œ ë³€ê²½í•˜ì—¬ count ìˆ˜ ì¡°íšŒ
    
ğŸ˜€example   
```java
List<Member> fetch = queryFactory
    .selectFrom(member)
    .fetch();

Member fetchOne = queryFactory
    .selectFrom(member)
    .where(member.username.eq("member2"))
    .fetchOne(); // ë‹¨ ê±´ ì¡°íšŒ (2ê±´ ì´ìƒì´ë©´ ì—ëŸ¬!)

Member fetchFirst = queryFactory
    .selectFrom(member)
    .fetchFirst();

long fetchCount = queryFactory
    .selectFrom(member)
    .fetchCount();

QueryResults<Member> fetchResults = queryFactory
    .selectFrom(member)
    .fetchResults();
``` 

3. sort
    * orderBy() ë„ ë§ˆì°¬ê°€ì§€ë¡œ ì—¬ëŸ¬ ê°’ì„ ,ë¥¼ ì‚¬ìš©í•˜ì—¬ ë„£ì„ ìˆ˜ ìˆë‹¤.   
    * .nullsLast()ë¡œ nullê°’ì´ ë§¨ ë’¤ì— ì˜¤ê²Œ í•  ìˆ˜ë„ ìˆê³ , nullsFirst()ë¡œ nullê°’ì´ ë§¨ ì²˜ìŒ ì˜¤ê²Œ í•  ìˆ˜ë„ ìˆë‹¤.   

ğŸ˜€example
```java
List<Member> members = queryFactory
      .selectFrom(member)
      .orderBy(member.username.desc(), member.age.asc().nullsLast())
      .fetch();
```   

4. paging
    * offset(n) : në²ˆì§¸ë¶€í„° ì‹œì‘ (0ë¶€í„° ì‹œì‘í•œë‹¤.)
    * limit(k) : kê°œì˜ ê°œìˆ˜ ì¶œë ¥
    
ğŸ˜€example 
```java
// 3ë²ˆì§¸ë¶€í„° 5ê°œ ê°€ì ¸ì˜¤ëŠ” ì¿¼ë¦¬
final List<Member> members = queryFactory
        .selectFrom(member)
        .orderBy(member.username.desc().nullsLast())
        .offset(2) // ì‹œì‘ì´ 0ë¶€í„°
        .limit(5)
        .fetch();

```    

ì‹¤í–‰ëœ SQLì€ ë‹¤ìŒê³¼ ê°™ë‹¤.   
ğŸ’»console
```sql
select 
    member0_.member_id as member_i1_0_, 
    member0_.age as age2_0_, 
    member0_.team_id as team_id4_0_, 
    member0_.username as username3_0_ 
from 
    member member0_ 
order by 
    case when member0_.username is null then 1 else 0 end, 
    member0_.username desc limit 2, 5
```

ğŸ‘Tip
ì „ì²´ ê°œìˆ˜ë¥¼ êµ¬í•  ë•Œì—ëŠ” countì¿¼ë¦¬ë¥¼ ë”°ë¡œ ì§¤ í•„ìš” ì—†ì´ fetchResults()ë¡œ ê°€ì ¸ì˜¤ë©´ ëœë‹¤.

ğŸ˜€example   
```java
// countì¿¼ë¦¬ê°€ ë¬´ì¡°ê±´ ë‚˜ê°€ê¸° ë•Œë¬¸ì— ì„±ëŠ¥ ê³ ë ¤
final QueryResults<Member> results = queryFactory
        .selectFrom(member)
        .orderBy(member.username.desc().nullsLast())
        .offset(7)
        .limit(5)
        .fetchResults();

assertThat(results.getTotal()).isEqualTo(10); // count ì¿¼ë¦¬ ì „ì²´ ê°œìˆ˜
assertThat(results.getLimit()).isEqualTo(5); // limit ê°œìˆ˜
assertThat(results.getOffset()).isEqualTo(7); // 8ë²ˆì§¸ë¶€í„°
assertThat(results.getResults().size()).isEqualTo(3); // 8 9 10 3ê°œ
```

5. group, having
ë‚˜ë¨¸ì§€ë„ sqlë¬¸ë²•ëŒ€ë¡œ group, having ì‚¬ìš©ê°€ëŠ¥í•˜ë‹¤. whereì²˜ëŸ¼ ì²´ì´ë‹ ë©”ì„œë“œë¡œ í™œìš©í•´ë„ ë˜ê³  ,ë¥¼ ì‚¬ìš©í•˜ì—¬ ì—¬ëŸ¬ íŒŒë¼ë¯¸í„°ë¡œ ë„˜ê²¨ì£¼ì–´ë„ ëœë‹¤.   

ğŸ˜€example   
```java
// 1. ê¸°ë³¸ì ì¸ ì§‘í•© í•¨ìˆ˜ì´ë‹¤. ë¦¬í„´ì€ ì—”í‹°í‹°ê°€ ì•„ë‹Œ Tupleë¡œ ê°€ëŠ¥í•˜ë‹¤. (Tupleì€ getìœ¼ë¡œ ê°’ì„ êº¼ë‚¼ ìˆ˜ ìˆë‹¤.)
final Tuple tuple = queryFactory
        .select(
                member.count(),
                member.age.sum(),
                member.age.avg(),
                member.age.max(),
                member.age.min()
        )
        .from(member)
        .fetchFirst();

// 2. group, having ì‚¬ìš©ê°€ëŠ¥í•˜ë‹¤.
final List<Tuple> tuples = queryFactory
    .select(team.name, member.age.avg())
    .from(member)
    .join(member.team, team)
    .groupBy(team.name)
    .having(member.age.avg().gt(10))
    .fetch();
```

## Reference
[ê³µì‹ í™ˆí˜ì´ì§€: http://querydsl.com/](http://querydsl.com/)     
[ê³µì‹ ë ˆí¼ëŸ°ìŠ¤:http://querydsl.com/static/querydsl/5.0.0/reference/html_single/](http://querydsl.com/static/querydsl/5.0.0/reference/html_single/)   
[https://www.baeldung.com/querydsl-with-jpa-tutorial](https://www.baeldung.com/querydsl-with-jpa-tutorial)     


