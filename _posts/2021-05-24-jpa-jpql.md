---
title:  "JPA Java Persistence Query Language"

categories:
  - jpa
tags:
  - jpa
  - jpql
last_modified_at: 2021-05-24T00:40:00-00:00
---

# What is JPQL
JPQLì€ Java Persistence Query Language ì˜ ì•½ìë¡œ Javaì˜ ê°ì²´ì§€í–¥ ì¿¼ë¦¬ ì–¸ì–´ì´ë‹¤.    
JPQLì€ ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸” ëŒ€ì‹  ì—”í‹°í‹° ê°œì²´ ëª¨ë¸ì„ ì‚¬ìš©í•˜ì—¬ SQL ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•œë‹¤.   
(ğŸ‘Tip : JPAëŠ” JPQLì„ ë°©ì–¸ì— ë”°ë¼ ì í•©í•œ ë°ì´í„°ë² ì´ìŠ¤ì˜ SQLë¡œ ë³€í™˜í•˜ëŠ” ê²ƒì´ë‹¤.)   

# Benefits of JPQL
1. DBì— ë…ë¦½ì ì´ë‹¤. SQLì„ ì¶”ìƒí™”í•˜ì—¬ íŠ¹ì • DBì— ì¢…ì†ë˜ì§€ ì•ŠìŒ.   
   (oracle, mysqlë“± ë°ì´í„°ë² ì´ìŠ¤ ë°©ì–¸ìœ¼ë¡œ êµì²´ê°€ëŠ¥)
2. ë™ì  ë˜ëŠ” ì •ì  ì¿¼ë¦¬ê°€ ê°€ëŠ¥í•˜ë‹¤.
3. ì¡°ì¸ ë™ì‘ì´ ìˆ˜í–‰ëœë‹¤. (ê¸°ë³¸ì¡°ì¸ ë¿ë§Œ ì•„ë‹ˆë¼ í˜ì¹˜ì¡°ì¸)
4. update, deleteë¡œ í•œ ë²ˆì— ë§ì€ ë°ì´í„° ì²˜ë¦¬ê°€ ê°€ëŠ¥í•˜ë‹¤.
5. í˜ì´ì§•, ì •ë ¬ ë“±ì˜ ì¿¼ë¦¬ê°€ ê°€ëŠ¥í•˜ë‹¤.
   
1. platform-independent query language. (oracle, mysql, etc...)
2. jpql queries can be dynamically and statically 
3. perform join operations.
4. update and delete data in a bulk.
5. perform aggregate function with sorting and grouping clauses.

# Simple start JPQL
ì˜ˆì œì— ì‚¬ìš©í•  ê°ì²´ì´ë‹¤. ì‹¤ì œ í…Œì´ë¸”ì€ ë‹¤ëŒ€ë‹¤ë¼ ì¡°ì¸í…Œì´ë¸”ì´ ìˆê³  Teacher ì— subject_id ì»¬ëŸ¼ì´ ìˆë‹¤.   
![jpql_table]({{ site.baseurl }}/assets/images/study/jpql_table.png)    
<br>
em.createQueryë¡œ jpqlì„ ì‹œì‘ í•  ìˆ˜ ìˆëŠ”ë° ì•ˆì˜ ë³€ìˆ˜ë¡œëŠ” Stringë§Œ ì§€ì •í•˜ë©´ Object[]ì´ ë¦¬í„´ë˜ê³ 
Stringê³¼ ë¦¬í„´í•  ì—”í‹°í‹° í´ë˜ìŠ¤ íƒ€ì…ìœ¼ë¡œ ì¡°íšŒí•˜ë©´ í•´ë‹¹ íƒ€ì…ìœ¼ë¡œ ë¦¬í„´ëœë‹¤.

ğŸ˜€ê°„ë‹¨í•œ ì˜ˆì œ   
```java
final List<Teacher> teacherList = 
    em.createQuery("select t from Teacher as t", Teacher.class).getResultList();
```

ğŸ’»console
```markdown 
Teacher(id=1, name=TmathA, classes=ADVANCE)
Teacher(id=2, name=TmathB, classes=BASIC)
```

## JPQL select
jpqlì˜ ë¬¸ë²•ì€ ëŒ€â€¢ì†Œë¬¸ìë¥¼ ê°€ë¦¬ì§„ ì•Šì§€ë§Œ ì¡°íšŒí•  ì—”í‹°í‹°ëŠ” ëŒ€â€¢ì†Œë¬¸ì êµ¬ë³„í•˜ì—¬ ì¨ì•¼í•œë‹¤.   
jpqlì˜ ê¸°ë³¸ ì¡°íšŒì¸ selectì— ëŒ€í•´ ì•Œì•„ë³´ì.      
from ì ˆ ë’¤ì— ì—”í‹°í‹°ê°€ ì˜¤ëŠ”ë° ê¼­ aliasë¥¼ ì£¼ì–´ì•¼ í•œë‹¤.
```sql
SELECT t FROM Teacher as t  -- Teacher í…Œì´ë¸” ëª¨ë“  ì»¬ëŸ¼ ì¡°íšŒ
SELECT t.subject FROM Teacher as t  -- ì¡°ì¸ëœ Subject í…Œì´ë¸” ì¡°íšŒ
SELECT DISTINCT t.id, t.name FROM Teacher as t  -- ì§€ì • ì»¬ëŸ¼ ì¡°íšŒ
```
ì—”í‹°í‹°ë¥¼ ê°€ì ¸ì˜¬ ë•ŒëŠ” TypedQueryë¡œ String ë’¤ì— Class íƒ€ì…ì„ ì¤˜ì„œ í¸í•˜ê²Œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆëŠ”ë° 3ë²ˆì§¸ ì§€ì • ì»¬ëŸ¼ ì¡°íšŒëŠ” Object[]ë¡œ ê°€ì ¸ì™€ì•¼í•œë‹¤.   
ğŸ˜€example   
```java
final List resultList = em.createQuery("select t.id, t.name from Teacher as t").getResultList();
for (Object o : resultList) {
    Object[] field = (Object[]) o;
    Long id = (Long) field[0];
    String name = (String) field[1];
    System.out.println("id : " +id + " name : " + name);
}
```
ğŸ’»console
```markdown
id : 1 name : TmathA
id : 2 name : TmathB
```

Objectë°°ì—´ë¡œ ì¡°íšŒí•˜ëŠ”ê²ƒì€ ê°€ë…ì„±ì´ ì¢‹ì§€ ì•Šë‹¤. TypedQueryì˜ í´ë˜ìŠ¤ë¡œ Dtoë¡œ ë°›ì„ ìˆ˜ ìˆì§€ë§Œ Dtoì˜ íŒ¨í‚¤ì§€ë¥¼ ëª¨ë‘ ì ì–´ì¤˜ì•¼í•œë‹¤.   
```java
// new ë¡œ ìƒì„±ìë¥¼ ë§Œë“œëŠ” ë¬¸ë²•ê³¼ ê°™ë‹¤.
final List<TeacherDto> resultList = em.createQuery("select new jpastudy.dto.TeacherDto(t.id, t.name) from Teacher as t", TeacherDto.class).getResultList();
```

## JPQL grammer
JPQLì€ SQLì˜ ê¸°ë³¸ ë¬¸ë²•ì¸ where, group by, having, order by ëª¨ë‘ ì§€ì›í•œë‹¤.
```java
String orderByQuery = "select s from Student as s where s.grades > 50 order by s.grades desc";
final List<Student> studentList =
        em.createQuery(orderByQuery, Student.class).getResultList();
```
ğŸ’»console
```markdown
Student(id=10, name=student9, classes=ADVANCE, grades=99)
Student(id=86, name=student85, classes=ADVANCE, grades=99)
Student(id=1, name=student0, classes=ADVANCE, grades=98)
Student(id=16, name=student15, classes=ADVANCE, grades=98)
â€¢â€¢â€¢
```

## Paging
í˜ì´ì§•ë„ jpaì—ì„œ ì •ë§ ê°„ë‹¨íˆ ì¶”ìƒí™” í•´ë†“ì•˜ë‹¤. setFirstResultë¡œ ì‹œì‘ê°’ setMaxResultsë¡œ ì¡°íšŒí•  ê°¯ìˆ˜ë¥¼ ë¶ˆëŸ¬ì˜¤ë©´ ëœë‹¤.   
setFirstResultì‹œ ì‹œì‘ì€ 0ì„ì„ ì£¼ì˜í•˜ì.   
```java
final List<Student> studentList =
        em.createQuery("select s from Student as s order by s.id asc", Student.class)
                .setFirstResult(3) // ì‹œì‘ì€ 0ë¶€í„°ë¼ 4ë²ˆì§¸ ê²ƒë¶€í„° ë¶ˆëŸ¬ì˜¨ë‹¤.
                .setMaxResults(5)
                .getResultList()
        ;
```
ğŸ’»console
```markdown
Student(id=4, name=student3, classes=BASIC, grades=21)
Student(id=5, name=student4, classes=BASIC, grades=20)
Student(id=6, name=student5, classes=ADVANCE, grades=60)
Student(id=7, name=student6, classes=ADVANCE, grades=56)
Student(id=8, name=student7, classes=BASIC, grades=24)
```

# Error Log
ğŸ’»console  
```markdown
org.hibernate.tool.schema.spi.CommandAcceptanceException: Error executing DDL "
â€¢â€¢â€¢
Caused by: java.sql.SQLSyntaxErrorException: (conn=34) Table 'jpastudy.teacher' doesn't exist
```
ì—ëŸ¬ê°€ "ì´ ë“¤ì–´ê°”ë‹¤ê³  í–ˆëŠ”ë° ì•„ë˜ ë³´ë‹ˆ ë¬¸ë²• ì—ëŸ¬ì˜€ë‹¤. 
```java
@Entity
public class Teacher {
    @Id
    @GeneratedValue
    @Column(name = "teacher_id")
    private Long id;

    private String name;

    @Enumerated(value = EnumType.STRING)
    private Group group;
    â€¢â€¢â€¢
```
ì—¬ê¸°ì„œ groupê°€ ì˜ˆì•½ì–´ì´ê¸° ë•Œë¬¸ì— teacherì´ ë§Œë“¤ì–´ì§€ì§€ì•Šì•„ ì—ëŸ¬ê°€ ë°œìƒí–ˆë‹¤.
   


## Reference
[https://www.javatpoint.com/jpa-jpql-introduction](https://www.javatpoint.com/jpa-jpql-introduction)   
[https://www.objectdb.com/java/jpa/query/jpql/structure](https://www.objectdb.com/java/jpa/query/jpql/structure)   


